<!doctype html>
<meta charset="utf-8">
<title>Catalog link check</title>
<style>
  body{font:15px system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:24px;line-height:1.45}
  h1{margin:0 0 12px}
  .ok{color:#128a41}
  .err{color:#b00020}
  table{border-collapse:collapse;width:100%;margin:12px 0}
  th,td{border:1px solid #e5e9ef;padding:8px 10px;text-align:left}
  code{background:#f6f8fa;padding:2px 4px;border-radius:4px}
</style>
<h1>Catalog link check</h1>
<p>Checks every <code>url_txt</code> in <code>/texts/catalog.json</code>, <code>/laws.json</code>, and <code>/rules.json</code>.</p>
<table id="tbl">
  <thead><tr><th>Source</th><th>Title</th><th>URL</th><th>Status</th></tr></thead>
  <tbody></tbody>
</table>
<script>
(async()=>{
  const body = document.querySelector('#tbl tbody');
  const cats = [
    {name:'Textbooks', url:'/texts/catalog.json'},
    {name:'Laws',      url:'/laws.json'},
    {name:'Rules',     url:'/rules.json'},
  ];
  const toAbs = p => /^https?:\/\//.test(p) ? p : new URL(p.startsWith('/')?p:'/'+p.replace(/^\.?\//,''), location.origin).href;
  const row = (src, title, url, ok) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${src}</td><td>${title||''}</td>
      <td><a href="${url}" target="_blank" rel="noopener">${url}</a></td>
      <td class="${ok?'ok':'err'}">${ok?'✅ OK':'❌ Not found'}</td>`;
    body.appendChild(tr);
  };
  for (const c of cats) {
    let data;
    try { const r = await fetch(c.url); data = await r.json(); }
    catch { data = []; row(c.name,'(catalog failed)', location.origin + c.url, false); continue; }
    for (const it of data) {
      const u = toAbs(it.url_txt||'');
      try { const r = await fetch(u, { method:'HEAD' }); row(c.name,it.title||it.reference,u,r.ok); }
      catch { row(c.name,it.title||it.reference,u,false); }
    }
  }
})();
</script>
