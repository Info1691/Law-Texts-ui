<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Search (beta) — Law Texts</title>
  <style>
    :root{
      --brand:#1e3a8a;
      --bg:#0b0f16;
      --card:#121826;
      --ink:#e5e7eb;
      --muted:#9ca3af;
      --accent:#60a5fa;
      --border:#22304a;
    }
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--ink);
      font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    header{
      background:var(--brand);color:#fff;padding:14px 16px;
      display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:10;
      box-shadow:0 2px 0 rgba(0,0,0,.25);
    }
    header img{height:28px;width:auto;background:#fff;border-radius:4px;padding:2px}
    header h1{font-size:16px;margin:0;font-weight:700;letter-spacing:.2px}
    main{max-width:1080px;margin:24px auto;padding:0 16px}
    .card{
      background:var(--card);border:1px solid var(--border);
      border-radius:12px;padding:16px;margin:0 0 16px 0;
    }
    .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .row input[type="search"]{
      flex:1 1 420px;min-width:260px;max-width:100%;
      background:#0a1220;border:1px solid var(--border);border-radius:10px;
      color:var(--ink);padding:10px 12px;outline:none;
    }
    .row input[type="number"]{
      width:110px;background:#0a1220;border:1px solid var(--border);
      border-radius:10px;color:var(--ink);padding:10px 12px;outline:none;
    }
    .row label{font-size:13px;color:var(--muted);display:inline-flex;gap:6px;align-items:center}
    .row button{
      background:var(--accent);color:#00112a;border:0;border-radius:10px;
      font-weight:700;padding:10px 14px;cursor:pointer;
    }
    #results .group h3{margin:.5rem 0}
    .hit{border:1px solid var(--border);border-radius:10px;padding:12px;margin:10px 0;background:#0f172a}
    .hit .meta{font-size:12px;color:var(--muted)}
    .hit .snip{margin:.5rem 0;background:#fff8c5;color:#111;padding:8px;border-radius:6px}
    mark{background:#fde68a}
    #bb-ft-stats{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <!-- your logo (white background). Replace ./logo.png if needed -->
    <img src="./logo.png" alt="Logo" />
    <h1>Search (beta) — Law Texts</h1>
  </header>

  <main>
    <section class="card">
      <form id="searchForm" class="row" action="" onsubmit="return false">
        <input id="q" name="q" type="search" placeholder='Try: beddoe consent litigation' autocomplete="off" />
        <input id="windowChars" name="window" type="number" min="80" step="20" value="240" title="Snippet window size (characters)" />
        <label><input id="orMode" type="checkbox" /> OR mode</label>
        <button id="runBtn" type="submit">Search</button>
      </form>
      <!-- The full-text toggle + status bar will be injected under the form -->
      <div id="search-stats" style="margin-top:6px"></div>
    </section>

    <!-- Native results container used by your existing search.js (if any) -->
    <section id="results" class="card">
      <h3 style="margin-top:0">Results</h3>
      <div id="resultsBody" class="body"></div>
    </section>
  </main>

  <!-- IMPORTANT: include fulltext-mode.js before (or after) search.js — order in HTML controls execution, not filename.
       Using defer ensures both execute after parsing in the order listed below. -->
  <script src="./fulltext-mode.js" defer></script>
  <script src="./search.js" defer></script>

  <script>
    // Small glue so the button/Enter triggers whichever mode is active.
    (function(){
      const form = document.getElementById('searchForm');
      const btn  = document.getElementById('runBtn');
      const q    = document.getElementById('q');
      const orCb = document.getElementById('orMode');

      function kick(){
        const query = (q.value||'').trim();
        if(!query) return;
        // If full-text toggle is ON, fulltext-mode.js will intercept and render.
        // Otherwise, try the page's Search.run if provided by search.js.
        if (window.__fulltext && window.__fulltext.state?.enabled) {
          window.__fulltext.run();
          return;
        }
        if (window.Search && typeof window.Search.run === 'function') {
          window.Search.run(query, { orMode: !!orCb.checked });
        }
      }

      form.addEventListener('submit', (e)=>{ e.preventDefault(); kick(); });
      btn.addEventListener('click', (e)=>{ e.preventDefault(); kick(); });

      // optional: run immediately if ?q= is in the URL
      const u = new URL(location.href);
      const qParam = u.searchParams.get('q');
      if(qParam){
        q.value = qParam;
        setTimeout(kick, 0);
      }
    })();
  </script>
</body>
</html>
